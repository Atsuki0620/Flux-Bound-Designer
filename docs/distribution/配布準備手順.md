# Flux規格提案くん 配布準備手順

## はじめに

この手順書では、Flux規格提案くんアプリケーションを配布用のZIPファイルにパッケージ化し、メールで送付するまでの手順を説明します。

### 対象者
技術的な知識が少ない方でも実施できるよう、画面操作を中心に詳しく説明しています。

### 前提条件
- プロジェクトフォルダ（`Spec-Finder`または`Flux-Bound-Designer`）が手元にあること
- Windows 10 または Windows 11 を使用していること
- プロジェクトフォルダ内に `app.py`、`requirements.txt`、`sample_data.csv` などがあること

### 所要時間
- 初回実行: 約20～30分
- 2回目以降: 約10～15分

---

## 手順1: PowerShellの準備

### 1-1. プロジェクトフォルダを開く

1. エクスプローラー（フォルダアイコン）を開きます
2. プロジェクトフォルダ（`Spec-Finder`または`Flux-Bound-Designer`）を探して開きます
3. フォルダ内に以下のファイルがあることを確認してください：
   - `app.py`
   - `requirements.txt`
   - `sample_data.csv`
   - `.venv` フォルダ（仮想環境）

### 1-2. PowerShellを開く

以下の2つの方法のいずれかでPowerShellを開きます。

**方法1: アドレスバーから開く（推奨）**
1. エクスプローラーの上部にあるアドレスバー（フォルダのパスが表示されている場所）をクリック
2. `powershell` と入力してEnterキーを押す
3. PowerShellウィンドウ（青い画面）が開きます

**方法2: 右クリックメニューから開く**
- **Windows 11の場合**: フォルダ内の空白部分で右クリック → 「ターミナルで開く」を選択
- **Windows 10の場合**: フォルダ内の空白部分で右クリック → 「PowerShellウィンドウをここで開く」を選択

### 1-3. パスの確認

PowerShellウィンドウが開いたら、プロンプト（入力待ち状態の表示）がプロジェクトフォルダのパスになっていることを確認してください。

例:
```
PS C:\Users\YourName\Documents\Spec-Finder>
```

**重要**: パスが異なる場合は、正しいフォルダでPowerShellを開き直してください。

---

## 手順2: 仮想環境の有効化

### 2-1. 有効化コマンドの実行

PowerShellに以下のコマンドを入力（またはコピー＆ペースト）して、Enterキーを押します。

```powershell
.\.venv\Scripts\Activate.ps1
```

### 2-2. 成功の確認

コマンドが成功すると、プロンプトの行頭に **`(.venv)`** が表示されます。

例:
```
(.venv) PS C:\Users\YourName\Documents\Spec-Finder>
```

この表示が出れば成功です。次の手順に進んでください。

### 2-3. エラーが出た場合の対処

#### エラー1: 「.venv\Scripts\Activate.ps1 が認識されません」

**原因**: 仮想環境が作成されていません。

**対処法**:
1. 以下のコマンドを実行して仮想環境を作成します：
   ```powershell
   python -m venv .venv
   ```
2. 完了したら、再度 `.\.venv\Scripts\Activate.ps1` を実行してください

#### エラー2: 「実行ポリシー」に関するエラー

**原因**: PowerShellのセキュリティ設定でスクリプト実行が制限されています。

**対処法**:
1. 以下のコマンドを実行します：
   ```powershell
   Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
   ```
2. 確認メッセージが表示されたら `Y` を入力してEnterキーを押します
3. 再度 `.\.venv\Scripts\Activate.ps1` を実行してください

---

## 手順3: PyInstallerでビルド

### 3-1. ビルドコマンドの実行

以下のコマンド全体をコピーして、PowerShellにペーストし、Enterキーを押します。

```powershell
.\.venv\Scripts\python -m PyInstaller `
  --noconfirm `
  --clean `
  --onedir `
  --name AppStart `
  --collect-all streamlit `
  --collect-all plotly `
  --collect-all statsmodels `
  --collect-all pandas `
  --collect-all numpy `
  run_streamlit_app.py
```

### 3-2. ビルド中の注意点

- **バッククォート（`` ` ``）について**: 上記のバッククォートは改行を意味するPowerShell記号です。コマンド全体を1つとしてコピー＆ペーストしてください
- **実行時間**: 3～10分程度かかります（PCのスペックによります）
- **ログ表示**: 途中で大量のログ（処理内容のメッセージ）が表示されますが、これは正常です
- **完了メッセージ**: `Building EXE from EXE-00.toc completed successfully.` のようなメッセージが表示されれば成功です

### 3-3. ビルド成功の確認

エクスプローラーでプロジェクトフォルダを確認し、以下が作成されていることを確認してください：

1. `dist` フォルダが作成されている
2. `dist` フォルダ内に `AppStart` フォルダがある
3. `dist\AppStart` フォルダ内に以下が存在する：
   - ✅ **AppStart.exe** （実行ファイル）
   - ✅ **_internal** フォルダ（内部ファイルが多数入っている）

**重要**: `_internal` フォルダは実行ファイルの動作に必要です。削除しないでください。

### 3-4. エラーが出た場合の対処

#### エラー: 「PyInstaller が見つかりません」

**原因**: 必要なパッケージがインストールされていません。

**対処法**:
1. 以下のコマンドを実行してパッケージをインストールします：
   ```powershell
   pip install -r requirements.txt
   ```
2. インストールが完了したら、再度PyInstallerコマンドを実行してください

---

## 手順4: 配布ファイルの準備

### 4-1. sample_data.csvのコピー

配布先でアプリの動作確認ができるよう、サンプルデータを同梱します。

1. エクスプローラーでプロジェクトフォルダのルート（トップ階層）にある **`sample_data.csv`** を探します
2. `sample_data.csv` を **右クリック** → **「コピー」** を選択
3. エクスプローラーで **`dist\AppStart`** フォルダを開きます
4. フォルダ内の空白部分で **右クリック** → **「貼り付け」** を選択
5. `AppStart.exe` と同じ場所に `sample_data.csv` が配置されたことを確認

### 4-2. 配布用README.txtの作成

配布先の方が使い方を理解できるよう、README.txtを作成します。

#### ステップ1: ファイルの作成

1. エクスプローラーで **`dist\AppStart`** フォルダを開きます
2. フォルダ内の空白部分で **右クリック** → **「新規作成」** → **「テキスト ドキュメント」** を選択
3. 新しいテキストファイル（`新しいテキスト ドキュメント.txt`）が作成されます
4. ファイル名を **`README.txt`** に変更します
   - ファイル名部分をクリックして編集可能にし、`README.txt`と入力してEnterキーを押します
   - 拡張子の変更確認が表示されたら「はい」をクリック

#### ステップ2: 内容の記載

1. `README.txt` を **ダブルクリック** して開きます（メモ帳が起動します）
2. 以下の内容を **コピー＆ペースト** します：

```
Flux規格提案くん - 配布版
======================================

## 概要
F.S.FluxとEle.Flowの回帰分析を行い、95%予測区間とEle.Flow上下限との交点を可視化するアプリケーションです。

## 起動方法
1. AppStart.exe をダブルクリックして起動
2. 自動的にブラウザが開き、http://localhost:8501 が表示されます
3. ブラウザが自動で開かない場合は、手動で http://localhost:8501 にアクセスしてください

## 動作確認
1. 同梱の sample_data.csv をアップロードしてください
2. Min_Ele_Flow と Max_Ele_Flow を入力（デフォルト値のままでOK）
3. 「解析実行」ボタンをクリック
4. グラフと解析結果が表示されれば正常動作しています

## 入力ファイル仕様
- CSV形式
- 必須列: F.S.Flux, Ele.Flow
- 3行以上のデータが必要
- 欠損値なし、数値のみ

## 終了方法
ブラウザのタブを閉じた後、PowerShellウィンドウまたはコマンドプロンプトウィンドウが開いている場合は、そのウィンドウも閉じてください。

## 動作環境
Windows 10/11

## 問い合わせ
不具合や質問がある場合は、[担当者連絡先]までご連絡ください。
```

3. メモ帳のメニューから **「ファイル」** → **「保存」** を選択
4. メモ帳を閉じます

### 4-3. 最終確認

`dist\AppStart` フォルダ内に以下の4つが揃っていることを確認してください：

- ✅ **AppStart.exe** （実行ファイル、自動生成）
- ✅ **_internal** フォルダ （内部ファイル多数、自動生成）
- ✅ **sample_data.csv** （サンプルデータ、手動コピー）
- ✅ **README.txt** （使用方法、手動作成）

**すべて揃っていれば次の手順に進んでください。**

---

## 手順5: 動作確認（任意、推奨）

配布前に、ビルドしたアプリケーションが正常に動作するか確認することをお勧めします。

### 5-1. ローカルテスト

1. エクスプローラーで `dist\AppStart` フォルダを開きます
2. **`AppStart.exe`** を **ダブルクリック** します
3. PowerShellまたはコマンドプロンプトのウィンドウが開き、その後ブラウザが自動で起動します
4. ブラウザで `http://localhost:8501` が表示され、「Flux規格提案くん」というタイトルが見えることを確認
5. 「ステップ2: CSVをアップロード」で `sample_data.csv` をアップロード
6. 「ステップ3: 解析条件を入力」でデフォルト値のまま「解析実行」をクリック
7. グラフと解析結果が表示されることを確認

### 5-2. 終了

1. ブラウザのタブを閉じます
2. PowerShellまたはコマンドプロンプトのウィンドウが開いている場合は、ウィンドウを閉じます
   - ウィンドウの右上の「×」ボタンをクリック、または `Ctrl + C` を押してから閉じる

**動作確認が完了したら、次の手順に進んでください。**

---

## 手順6: ZIP圧縮

配布用にフォルダをZIPファイルに圧縮します。

### 6-1. エクスプローラーからZIP圧縮（推奨）

1. エクスプローラーで **`dist`** フォルダを開きます
2. **`AppStart`** フォルダを **右クリック** します
3. メニューから **「送る」** → **「圧縮 (zip 形式) フォルダー」** を選択します
4. 同じ場所（`dist`フォルダ内）に **`AppStart.zip`** が作成されます

### 6-2. ZIPファイル名の変更（任意）

バージョンや日付を含めたファイル名にしたい場合は、以下の手順で名前を変更できます。

1. `AppStart.zip` を **右クリック** → **「名前の変更」** を選択
2. 新しいファイル名を入力します
   - 例: `AppStart_v1.0_20260212.zip`
   - 例: `AppStart_配布用.zip`
3. Enterキーを押して確定

### 6-3. PowerShellコマンドでZIP圧縮（代替方法）

エクスプローラーでの操作がうまくいかない場合、PowerShellコマンドでも圧縮できます。

1. PowerShellで以下のコマンドを実行します：
   ```powershell
   Compress-Archive -Path .\dist\AppStart -DestinationPath .\dist\AppStart.zip
   ```
2. `dist` フォルダ内に `AppStart.zip` が作成されます

### 6-4. ZIPファイルのサイズ確認

作成された `AppStart.zip` を右クリック → 「プロパティ」を選択し、ファイルサイズを確認します。

- **正常な場合**: 約100～300MB程度（依存ライブラリを含むため大きくなります）
- **サイズが小さすぎる場合**（例: 10MB以下）: 圧縮に失敗している可能性があります。手順6-1または6-3を再実行してください

**メール添付の制限について**:
- 一般的なメールシステムの添付ファイル制限は10～25MB程度です
- ZIPファイルがこれを超える場合は、**手順7-2（ファイル転送サービス）** を使用してください

---

## 手順7: メール送信

### 7-1. ZIPファイルのサイズが小さい場合（25MB以下）

メールに直接添付して送信できます。

#### ステップ1: メールの作成

1. メールソフト（Outlook、Gmail、Thunderbirdなど）を開きます
2. 「新規メール作成」をクリックします

#### ステップ2: ZIPファイルの添付

1. メール作成画面で「添付ファイル」または「ファイルを添付」ボタンをクリック
2. エクスプローラーが開くので、`dist` フォルダ内の `AppStart.zip` を選択
3. 「開く」または「選択」をクリックして添付

#### ステップ3: メール本文の作成

以下の例文を参考に、件名と本文を記載します。

**件名**:
```
【配布】Flux規格提案くん アプリケーション
```

**本文**:
```
お疲れ様です。

Flux規格提案くん アプリケーションの配布版をお送りします。

【内容物】
- AppStart.exe（実行ファイル）
- sample_data.csv（動作確認用サンプルデータ）
- README.txt（使用方法）
- _internalフォルダ（実行に必要な内部ファイル）

【使用方法】
1. 添付のZIPファイルを解凍してください
2. AppStart.exeをダブルクリックして起動
3. 詳細はREADME.txtをご参照ください

【動作確認】
sample_data.csvをアップロードして正常に動作するかご確認ください。

不明点や不具合がございましたら、お気軽にお問い合わせください。

よろしくお願いいたします。
```

#### ステップ4: 送信

1. 宛先（To）、CC、BCCを適切に入力
2. 件名と本文を確認
3. 添付ファイルが正しく追加されていることを確認
4. 「送信」ボタンをクリック

### 7-2. ZIPファイルのサイズが大きい場合（25MB超）

ファイル転送サービスを利用します。

#### ステップ1: ファイル転送サービスの選択

以下のようなサービスを利用できます（会社のポリシーに従ってください）：

- **Google Drive**（Googleアカウントが必要）
- **OneDrive**（Microsoftアカウントが必要）
- **Dropbox**
- **GigaFile便**（会員登録不要、無料）
- **その他、会社で指定されているサービス**

#### ステップ2: ZIPファイルのアップロード

以下は一般的な手順です（サービスによって多少異なります）：

1. ファイル転送サービスのWebサイトまたはアプリを開きます
2. 「ファイルをアップロード」または「ファイルを選択」をクリック
3. `dist\AppStart.zip` を選択してアップロード
4. アップロードが完了するまで待ちます（数分～十数分かかる場合があります）

#### ステップ3: 共有リンクの取得

1. アップロードが完了したら、「共有リンクを取得」または「リンクをコピー」をクリック
2. リンクがクリップボードにコピーされます
3. リンクをメモ帳などに一時保存しておきます

#### ステップ4: メールの作成と送信

以下の例文を参考に、メールを作成します。

**件名**:
```
【配布】Flux規格提案くん アプリケーション（ダウンロードリンク）
```

**本文**:
```
お疲れ様です。

Flux規格提案くん アプリケーションの配布版を以下のリンクからダウンロードできます。

【ダウンロードリンク】
[ここに取得した共有リンクを貼り付け]

有効期限: [期限がある場合は記載、例: 2026年2月28日まで]

【使用方法】
1. 上記リンクからZIPファイルをダウンロード
2. ZIPファイルを解凍
3. AppStart.exeをダブルクリックして起動
4. 詳細はREADME.txtをご参照ください

【動作確認】
sample_data.csvをアップロードして正常に動作するかご確認ください。

不明点や不具合がございましたら、お気軽にお問い合わせください。

よろしくお願いいたします。
```

---

## トラブルシューティング

### エラー: 「.venv\Scripts\Activate.ps1 が認識されません」

**原因**: 仮想環境が作成されていません。

**対処法**:
```powershell
python -m venv .venv
```
を実行して仮想環境を作成してから、再度有効化コマンドを実行してください。

---

### エラー: 「実行ポリシー」に関するエラー

**原因**: PowerShellのセキュリティ設定でスクリプト実行が制限されています。

**対処法**:
```powershell
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
```
を実行してから、再度有効化コマンドを実行してください。

---

### エラー: 「PyInstaller が見つかりません」

**原因**: 必要なパッケージがインストールされていません。

**対処法**:
```powershell
pip install -r requirements.txt
```
を実行してパッケージをインストールしてから、再度PyInstallerコマンドを実行してください。

---

### ビルドは成功したが、exeが起動しない

**原因**: `_internal` フォルダが不足または破損している可能性があります。

**対処法**:
1. `dist` フォルダと `build` フォルダを削除
2. 以下のコマンドで再ビルド（`--clean` オプションでクリーンビルド）:
   ```powershell
   .\.venv\Scripts\python -m PyInstaller `
     --noconfirm `
     --clean `
     --onedir `
     --name AppStart `
     --collect-all streamlit `
     --collect-all plotly `
     --collect-all statsmodels `
     --collect-all pandas `
     --collect-all numpy `
     run_streamlit_app.py
   ```

---

### exeは起動するが、ブラウザが開かない

**対処法**:
1. ブラウザを手動で開きます
2. アドレスバーに `http://localhost:8501` を入力してEnterキーを押します
3. アプリケーション画面が表示されれば正常です

---

### ZIPファイルが作成できない

**対処法**:
PowerShellコマンドで圧縮を試してください:
```powershell
Compress-Archive -Path .\dist\AppStart -DestinationPath .\dist\AppStart.zip
```

---

## まとめ

以上で配布準備が完了しました。

### 配布物の最終チェックリスト

配布前に、以下を再確認してください：

- ✅ `AppStart.zip` が作成されている
- ✅ ZIP内に `AppStart.exe`、`_internal` フォルダ、`sample_data.csv`、`README.txt` が含まれている
- ✅ ZIPファイルのサイズが正常（100～300MB程度）
- ✅ （任意）ローカルで動作確認済み
- ✅ メールの宛先、件名、本文が適切
- ✅ 添付ファイルまたは共有リンクが正しい

### 今後の参考

- 2回目以降は、手順1～3を実行すれば更新版をビルドできます
- 配布のたびに `sample_data.csv` と `README.txt` を追加する必要があります
- バージョン管理のため、ZIPファイル名に日付やバージョン番号を含めることをお勧めします

お疲れ様でした！
